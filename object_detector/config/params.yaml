# Object Detection System Configuration
# 
# This file contains all parameters for the object detection pipeline.
# Units are specified in comments for each parameter.

# ==============================================================================
# Scan Processor Node Configuration
# ==============================================================================
scan_processor_node:
  ros__parameters:
    # -------------------------------------------------------------------------
    # Scan Data Filtering Parameters
    # -------------------------------------------------------------------------
    # Laser scan data will be filtered based on these range and angle limits
    scan_range_min: 0.0           # [m] Minimum range to consider from laser scan
    scan_range_max: 8.0           # [m] Maximum range to consider from laser scan
    scan_angle_min: -2.35619      # [rad] Minimum angle (~-135°, -3π/4)
    scan_angle_max: 2.35619       # [rad] Maximum angle (~+135°, +3π/4)
    
    # -------------------------------------------------------------------------
    # DBSCAN Clustering Parameters
    # -------------------------------------------------------------------------
    # These parameters control how scan points are grouped into clusters
    min_cluster_points: 3         # [count] Minimum points to form a cluster
    dbscan_epsilon: 0.03          # [m] Maximum distance between points in cluster
    dbscan_max_points: 100        # [count] Maximum points allowed in one cluster
    
    # -------------------------------------------------------------------------
    # Wall Filtering Parameters
    # -------------------------------------------------------------------------
    # Parameters for identifying and filtering out wall structures
    wall_distance_threshold: 0.06     # [m] Max distance to group consecutive points
    wall_line_max_error: 0.005        # [m] Max error for line fitting
    min_wall_cluster_points: 6        # [count] Min points to identify as wall
    wall_length_threshold: 0.35       # [m] Min length to classify as wall
    
    # -------------------------------------------------------------------------
    # Far Obstacle Filtering Parameters
    # -------------------------------------------------------------------------
    # Special handling for distant obstacles to reduce false positives
    far_obstacle_distance_threshold: 4.5  # [m] Distance threshold for "far"
    far_obstacle_min_points: 12           # [count] Min points for far obstacles
    dynamic_wall_gap_factor: 2.8          # [multiplier] Dynamic threshold scale
    
    # -------------------------------------------------------------------------
    # Statistical Outlier Removal (SOR) Parameters
    # -------------------------------------------------------------------------
    # PCL Statistical Outlier Removal filter settings
    sor_mean_k: 8                 # [count] Number of neighbors for statistics
    sor_stddev_mul: 2.0          # [multiplier] Standard deviation multiplier
    
    # -------------------------------------------------------------------------
    # Temporal Window Parameters
    # -------------------------------------------------------------------------
    window_seconds: 0.25          # [s] Time window for data buffering


# ==============================================================================
# Obstacle Detector Node Configuration
# ==============================================================================
obstacle_detector_node:
  ros__parameters:
    # -------------------------------------------------------------------------
    # DBSCAN Clustering Parameters (Second Stage)
    # -------------------------------------------------------------------------
    # Clustering of obstacle candidates in map frame
    dbscan_eps: 0.25              # [m] Epsilon (max distance between points)
    dbscan_min_points: 5          # [count] Min points to form core cluster
    
    # -------------------------------------------------------------------------
    # Representative Point Calculation
    # -------------------------------------------------------------------------
    use_weighted_median: true     # [bool] Use weighted median vs weighted mean
    min_candidates_to_process: 3  # [count] Min candidates needed to process
    
    # -------------------------------------------------------------------------
    # Kalman Filter Parameters
    # -------------------------------------------------------------------------
    # Settings for tracking dynamic obstacles using Kalman filter
    use_kalman_filter: true       # [bool] Enable/disable Kalman filtering
    kalman_process_noise: 0.2     # [m²/s²] Process noise covariance
    kalman_measurement_noise: 0.05 # [m²] Measurement noise covariance
    
    # -------------------------------------------------------------------------
    # Tracking Parameters
    # -------------------------------------------------------------------------
    obstacle_timeout: 0.03        # [s] Time before declaring obstacle lost
    association_gate: 1.2         # [m] Max distance for data association
    
    # -------------------------------------------------------------------------
    # Temporal Window Parameters
    # -------------------------------------------------------------------------
    window_seconds: 0.25          # [s] Sliding window duration
    
    # -------------------------------------------------------------------------
    # Topic Names (Optional Override)
    # -------------------------------------------------------------------------
    # Uncomment to override default topic names
    # wall_topic: "/wall_points"
    # scan_topic: "/scan"
    # odom_topic: "/odom"
    
    # -------------------------------------------------------------------------
    # Wall Processing Parameters (Future Use)
    # -------------------------------------------------------------------------
    wall_deque_size: 10           # [count] Buffer size for wall point clouds
    voxel_leaf: 0.03              # [m] Voxel grid leaf size for downsampling
    knn_k: 5                      # [count] K-nearest neighbors
    wall_dist_thresh: 0.06        # [m] Distance threshold for wall matching


# ==============================================================================
# Parameter Tuning Guidelines
# ==============================================================================
#
# scan_range_max:
#   - Increase: Consider obstacles further away (may increase noise)
#   - Decrease: Focus on nearby obstacles (reduces computation)
#
# dbscan_epsilon:
#   - Increase: Larger, fewer clusters (may merge distinct objects)
#   - Decrease: Smaller, more clusters (may split single objects)
#
# kalman_process_noise:
#   - Increase: Filter responds faster to changes (more jittery)
#   - Decrease: Filter responds slower (smoother but delayed)
#
# kalman_measurement_noise:
#   - Increase: Trust measurements less (smoother, less responsive)
#   - Decrease: Trust measurements more (more jittery, more responsive)
#
# obstacle_timeout:
#   - Increase: Track obstacles longer when occluded
#   - Decrease: Drop tracks faster when no measurement
#
# ==============================================================================